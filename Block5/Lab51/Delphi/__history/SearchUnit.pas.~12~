Unit SearchUnit;

Interface

Uses
    Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
    Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ComCtrls, Vcl.StdCtrls;

Type
    TSearchForm = Class(TForm)

    SearchLabel: TLabel;
    SearchDateTimePicker: TDateTimePicker;
    SearchButton: TButton;
    CancelButton: TButton;

    Procedure SearchButtonClick(Sender: TObject);
    Procedure CloseButtonClick(Sender: TObject);

    Private
      { Private declarations }
    Public
      { Public declarations }
    End;

Var
  SearchForm: TSearchForm;

Implementation

{$R *.dfm}

Uses MainUnit;

Procedure TSearchForm.SearchButtonClick(Sender: TObject);
Var
    I, ClosestDateIndex: Integer;
    MinDifference, Difference: Double;
    FoundDateAfter: Boolean;
Begin
    FoundDateAfter := False;
    ClosestDateIndex := 0;
    MinDifference := MaxInt;
    For I := 1 To High(ShowsArr) Do
    Begin
        Difference := ShowsArr[I].Date - SearchDateTimePicker.Date + ShowsArr[I].Time - SearchDateTimePicker.Time;
        If Difference >= 0 Then
        Begin
            If Difference < MinDifference Then
            Begin
              MinDifference := Difference;
              ClosestDateIndex := I;
              FoundDateAfter := True;
            End;
        End;
    End;
    If FoundDateAfter Then
    Begin
        MainForm.ShowsStringGrid.Row := ClosestDateIndex;
        Close;
    End
    Else
        Application.MessageBox('Увы ближайших спектаклей не предвидится!', 'Сорри', MB_OK + MB_ICONHAND);
End;

Procedure TSearchForm.CloseButtonClick(Sender: TObject);
Begin
    Close;
End;


End.                    
